{"title":"標本分布を理解する","markdown":{"headingText":"標本分布を理解する","containsRefs":false,"markdown":"\n**今回の目標**\n\n-   標本分布を理解しよう！\n-   標準誤差を理解しよう！\n\n## 準備 {#sec-prep12}\n\n必要なパッケージを読み込む。\n\n```{r}\n#| message: false\nlibrary(tidyverse)\n## 図のなかで日本語を使えるようにする\n## フォントの設定はお好みで\n## （Unix/Linux ではIPAexフォントのインストールが必要かも）\nif (.Platform$OS.type == \"windows\") { # Windows\n  library(fontregisterer)\n  my_font <- \"Yu Gothic\"\n} else if (capabilities(\"aqua\")) { # macOS\n  my_font <- \"HiraginoSans-W3\"\n} else { # Unix/Linux\n  my_font <- \"IPAexGothic\"\n}\ntheme_set(theme_gray(base_size = 9,\n                     base_family = my_font))\n```\n\n## 標本分布のシミュレーション {#sec-simsd}\n\n### シミュレーション問題の設定 {#sec-simset}\n\n母集団（成人男性全体）では、平均身長が170cm、身長の標準偏差が5.5cm であり、身長は正規分布に従うことを知っているとする。\n\n```{r}\nmu <- 170     # 母平均\nsigma <- 5.5  # 母標準偏差\n```\n\n以下では、様々な標本サイズで標本を抽出し、その標本の平均身長を求める作業を 1万回ずつ繰り返すことにする。\n\n```{r}\nn_sims <- 1e4  # シミュレーションの繰り返し回数\n```\n\n### 標本サイズ ($N$) が1のとき {#sec-n1}\n\n標本サイズ $N = 1$ で標本を抽出し、標本平均を計算することを`r n_sims` 回`n_sims` 回）繰り返す。まず、$N$ を設定する。\n\n```{r}\nN <- 1\n```\n\n1回の標本抽出は、\n\n```{r}\nh <- rnorm(N, mean = mu, sd = sigma)\n```\n\nで行える。標本平均は、\n\n```{r}\nmean(h)\n```\n\nである。 これを1万回繰り返せばよい。\n\n（本当はもっと簡単な方法もあるが） `for` ループを使ってシミュレーションを実行してみよう。\n\nまず、結果を保存するために、`r n_sims` 個の値を保存する容器（ベクトル）を用意する。要素（中身）は `NA` にしておく。\n\n```{r}\nsim_1 <- rep(NA, n_sims)\n```\n\nシミュレーションを実行する準備が整ったので、`for`ループでシミュレーションを実行する（`for`ループ以外で実行する方法を知っている者は、その方法を利用してよい）。\n\n```{r}\nfor (i in 1:n_sims) {\n  h <- rnorm(N, mean = mu, sd = sigma)\n  sim_1[i] <- mean(h)\n}\n```\n\n結果をヒストグラムにしてみよう。\n\n```{r}\ndf1 <- tibble(sim_1)\nhist1 <- ggplot(df1, aes(x = sim_1, y = after_stat(density))) +\n  geom_histogram(color = \"black\", \n                 fill = \"dodgerblue\") +\n  labs(x = \"身長の標本平均 (cm)\",\n       y = \"確率密度\",\n       title = \"N = 1 の標本分布\")\nplot(hist1)\n```\n\nこのヒストグラムに、平均 170、標準偏差 5.5 の正規分布 ($\\mbox{N}(170, 5.5)$ と表記する) の確率密度曲線を重ね書きしてみよう。\n\n```{r}\ndf1$x <- seq(140, 200, length.out = nrow(df1))\ndf1$dens <- dnorm(df1$x, mean = mu, sd = sigma)\nhist1_2 <- hist1 + \n  geom_line(data = df1, \n            aes(x = x, y = dens), \n            color = \"red\", \n            size = 1.5)\nplot(hist1_2)\n```\n\n図を見る限り、標本平均の標本分布と、母集団の分布はとてもよく似ている。\n\n統計量も確かめてみよう。\n\n```{r}\nmean(sim_1) # 標本平均の平均値\nsd(sim_1)   # 標本平均の標準偏差 = 標準誤差\n```\n\nこのように、標本平均の平均値は母平均とほぼ同じであり、標本平均の標準偏差（これを平均値の**標準誤差 (standard errors; SE)** と呼ぶ）は、母標準偏差とほぼ同じである。\n\n### 標本サイズ ($N$) が2のとき {#sec-n2}\n\n標本サイズ $N = 2$ で、同様のシミュレーションを行ってみよう。 まず、$N$ を設定する。\n\n```{r}\nN <- 2\n```\n\nあとは、さきほどと同様のコマンドを実行すればよい。ただし、結果を上書きしないように、結果に異なる名前をつける。\n\n```{r}\nsim_2 <- rep(NA, n_sims) \nfor (i in 1:n_sims) {\n  h <- rnorm(N, mean = mu, sd = sigma)\n  sim_2[i] <- mean(h)  # sim_2 を使う\n}\n```\n\n結果をヒストグラムにしてみよう。\n\n```{r}\ndf2 <- tibble(sim_2)\nhist2 <- ggplot(df2, aes(x = sim_2, y = after_stat(density))) +\n  geom_histogram(color = \"black\", \n                 fill = \"dodgerblue\") +\n  labs(x = \"身長の標本平均 (cm)\",\n       y = \"確率密度\",\n       title = \"N = 2 の標本分布\")\nplot(hist2)\n```\n\nこのヒストグラムに、平均 170、標準偏差 5.5 の正規分布 ($\\mbox{Normal}(170, 5.5)$) の確率密度曲線を重ね書きしてみよう。\n\n```{r}\nhist2_2 <- hist2 + \n  geom_line(data = df1, \n            aes(x = x, y = dens), \n            color = \"red\", \n            size = 1.5)\nplot(hist2_2)\n```\n\n先ほどとは異なり、標本平均の標本分布と、母集団の分布は少し異なる。標本分布の方が、母集団よりも狭い範囲に集まっていることがわかる。\n\n統計量も確かめてみよう。\n\n```{r}\nmean(sim_2) # 標本平均の平均値\nsd(sim_2)   # 標本平均の標準偏差 = 標準誤差\n```\n\n上のシミュレーションと同様、標本平均の平均値は母平均とほぼ同じである。しかし、標本平均の標準偏差である**標準誤差 (standard errors; SE)** は、母標準偏差よりもかなり小さくなっていることがわかる。\n\n理論的には、標本平均の標準偏差は $母標準偏差/\\sqrt{標本サイズ}$ になるはずである。確かめてみよう。\n\n```{r}\nsigma / sqrt(N)\n```\n\nこれは、上で求めた標準誤差にほぼ一致する。\n\n### 標本サイズ ($N$) が10のとき {#sec-n10}\n\n標本サイズ $nN = 10$ で同様のシミュレーションを行ってみよう。 まず、$N$ を設定する。\n\n```{r}\nN <- 10\n```\n\nあとは、先ほどと同様のコマンドを実行すればよい。ただし、結果を上書きしないように、結果に異なる名前をつける。\n\n```{r}\nsim_3 <- rep(NA, n_sims) \nfor (i in 1:n_sims) {\n  h <- rnorm(N, mean = mu, sd = sigma)\n  sim_3[i] <- mean(h)  # sim_3 を使う\n}\n```\n\n結果をヒストグラムにしてみよう。\n\n```{r}\ndf3 <- tibble(sim_3)\nhist3 <- ggplot(df3, aes(x = sim_3, y = after_stat(density))) +\n  geom_histogram(color = \"black\", \n                 fill = \"dodgerblue\") +\n  labs(x = \"身長の標本平均 (cm)\", \n       y = \"確率密度\",\n       title = \"N = 10 の標本分布\")\nplot(hist3)\n```\n\nこのヒストグラムに、平均 170、標準偏差 5.5 の正規分布 ($\\mbox{N}(170, 5.5)$) の確率密度曲線を重ね書きしてみよう。\n\n```{r}\nhist3_2 <- hist3 +\n  geom_line(data = df1, \n            aes(x = x, y = dens), \n            color = \"red\", \n            size = 1.5)\nplot(hist3_2)\n```\n\n標本分布がさらに狭い範囲に集まっていることがわかる。\n\n統計量を確かめてみよう。\n\n```{r}\nmean(sim_3) # 標本平均の平均値\nsd(sim_3)   # 標本平均の標準偏差 = 標準誤差\n```\n\n先程と同様、標本平均の平均値は母平均とほぼ同じである。また、標本平均の標準偏差である**標準誤差 (standard errors; SE)** は、母標準偏差よりもより一層小さくなっていることがわかる。\n\n理論的には、標本平均の標準偏差は $母標準偏差/\\sqrt{標本サイズ}$ になるはずである。確かめてみよう。\n\n```{r}\nsigma / sqrt(N)\n```\n\nこれは、上で求めた標準誤差にほぼ一致する。\n\n### 実習課題 {#sec-ex12}\n\n標本サイズ $N$ を50、100にして、同様のシミュレーションを実行しよう。どのようなことがわかるか文章にまとめて整理しよう。\n\n## 誤差の分布 {#sec-error}\n\n標本平均の誤差は、 $$誤差 = 標本平均 - 母平均$$ と表すことができる。また、標本平均の平均値（期待値）は母平均に等しいので、 $$誤差 = 標本平均 - 標本平均の平均値$$ でも同じことである。\n\nしたがって、上で実行した3つのシミュレーション（それぞれ、$N = 1, 2, 10$）の誤差 `err_1`, `err_2`, `err_3` は、\n\n```{r}\nerr_1 <- sim_1 - mean(sim_1)\nerr_2 <- sim_2 - mean(sim_2)\nerr_3 <- sim_3 - mean(sim_3)\n```\n\nである。さらに、それぞれを標準誤差（標本平均の標準偏差の推定値）で割ってみる。\n\n```{r}\nz1 <- err_1 / sd(sim_1)\nz2 <- err_2 / sd(sim_2)\nz3 <- err_3 / sd(sim_3)\n```\n\n平均値を引いて、それを標準偏差で割っているので、これは標準化 (standardization あるいは $z$化) である。\n\nここで、標準正規分布 $\\mbox{Normal}(0, 1)$ の分布を図にしてみよう。\n\n```{r}\ndf_nml <- tibble(z = seq(from = -4, to = 4, length.out = 1000))\ndf_nml$dens <- dnorm(df_nml$z,  mean = 0, sd = 1)\nstdn <- ggplot(df_nml, aes(x = z, y = dens)) +\n  geom_line() +\n  labs(y = \"確率密度\")\nplot(stdn)\n```\n\nこの図に、先ほど計算した `z1`, `z2`, `z3` の分布を上書きしてみよう。確率密度 (density) を加えるため、`geom_density()` を使う。\n\n```{r}\ndf_z <- tibble(z1, z2, z3)\ndens_lines <- stdn +\n  geom_density(data = df_z, \n               aes(x = z1, y = after_stat(density)),\n               color = \"red\") +\n  geom_density(data = df_z, \n               aes(x = z2, y = after_stat(density)), \n               color = \"blue\") +\n  geom_density(data = df_z, \n               aes(x = z3, y = after_stat(density)),\n               color = \"orange\")\nplot(dens_lines)\n```\n\nこのように、標本平均を標準化すると、標準正規分布に似た分布が出てくる（4つの曲線が重なり合っていて区別が難しい）。よって、標準正規分布を利用した推定ができそうに見える（本当にできるかどうかは他の機会に解説する）。\n\n## 標本分布のシミュレーション {#sec-mp4}\n\n標本分布のシミュレーション動画 (MP4) を例として示す\n\n-   [$N = 1$](https://yukiyanai.github.io/jp/classes/stat2/contents/R/sampling_distribution_n1.mp4)\n-   [$N = 2$](https://yukiyanai.github.io/jp/classes/stat2/contents/R/sampling_distribution_n2.mp4)\n-   [$N = 10$](https://yukiyanai.github.io/jp/classes/stat2/contents/R/sampling_distribution_n10.mp4)\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":5,"fig-height":4,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":true,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":true,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"number-sections":true,"highlight-style":"arrow","html-math-method":"mathjax","output-file":"sampling-distribution.html"},"language":{"toc-title-document":"このページの内容","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"注","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"コードを表示","code-tools-hide-all-code":"コードを隠す","code-tools-view-source":"Source を見る","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"コピーする","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"図","crossref-tbl-title":"表","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Newest","listing-page-order-by-date-desc":"Oldest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","crossref":{"ref-hyperlink":true},"theme":"yeti"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}