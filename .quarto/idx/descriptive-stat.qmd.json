{"title":"記述統計","markdown":{"headingText":"記述統計","containsRefs":false,"markdown":"\n**今回の目標**\n\n-   Rで基本的な統計量を求めてみよう！\n-   Rで作図する例を見てみよう！（今回は、作図コードの内容を理解しなくても良い）\n\n## 1変数の記述統計とデータの可視化 {#sec-1var}\n\n### パッケージの読み込み {#sec-pacs}\n\nまず、この授業で頻繁（ほぼ常に）に使う、**tidyverse**パッケージをインストールしよう。既にインストール済みなら、改めてインストールする必要はない。割と時間がかかるので注意。\n\n::: callout-important\n大学の情報演習室のパソコンを使っている場合は、パッケージをインストールしてはいけない。基本的なパッケージはインストール済みなので、さらにインストールすると同じパッケージが二箇所に存在することになり、トラブルのもとになる。大学PCにインストールしなければならないパッケージ（[CRAN](https://cran.r-project.org/)に登録されていないパッケージ）もある が、そのときは別途アナウンスする。\n:::\n\nパッケージのインストールには、`install.packages()` という関数を使う。**パッケージをインストールするにはネット接続が必須**。 パッケージは1度インストールすれば、Rのバージョンアップを行うまでそのまま使える。**同じパッケージを何度もインストールしないように注意！**（時間のムダ） **大学PCを使っている場合、以下のコードは実行しない**（理由は上に書いたとおり）。\n\n```{r}\n#| eval: false\ninstall.packages(\"tidyverse\")\ninstall.packages(\"systemfonts\")\ninstall.packages(\"shiny\")\ninstall.packages(\"miniUI\")\ninstall.packages(\"DT\")\ninstall.packages(\"patchwork\")\ninstall.packages(\"remotes\")\n```\n\n:::callout-tip\n手間を少し減らしたい場合は、\n\n```{r}\n#| eval: false\npkgs <- c(\"tidyverse\", \n          \"sytemfonts\",\n          \"shiny\",\n          \"miniUI\",\n          \"DT\",\n          \"patchwork\",\n          \"remotes\")\ninstall.packages(pkgs)\n```\nのようにすればよい。\n:::\n\n\nただし、一部のパッケージは `install.packages()` 以外の方法でインストールする必要がある。この授業では必要になるたびに説明する。 今日はとりあえず次のコードを実行する（**大学PCでは実行しない！**)。\n\n```{r}\n#| eval: false\nremotes::install_github(\"Gedevan-Aleksizde/fontregisterer\", \n                        repos = NULL, \n                        type = \"source\")\n```\n\n:::callout-tip\nRで利用可能なパッケージのうち、[CRAN (Comprehensive R Archive Network)](https://cran.r-project.org/) に登録されているものは、`install.packages()` でインストールする。\n\n上でインストールした [fontregisterer](https://github.com/Gedevan-Aleksizde/fontregisterer) のように、CRANには登録されていないが [GitHub](https://github.com/) で公開されているものは、`remotes::install_github()` または `devtools::install_github()` でインストールすることができる。\n:::\n\n\nインストールが完了したら、`library()` でパッケージを読み込もう。パッケージの読み込みは、R (RStudio) を起動するたびに行う必要がある。つまり、`library()` はそのパッケージを使う場合には毎回実行する必要がある。また、複数の Rmd で同じパッケージを使う場合には、それぞれの Rmdファイルに`library()` でパッケージを読み込む命令を書いておく必要がある（Rmd ファイルについては [5章](r-markdown.html) で説明する）。\n\n```{r}\n#| message: false\nlibrary(tidyverse)\n```\n\n図中の日本語が文字化けすることがあるので、OSに合わせてフォントを指定する以下のコードを実行する（RStudio Cloud の場合は回避策が面倒なので省略。Cloudユーザは 英語 \\[アルファベット\\] を使うように）。これは、`library(tidyverse)` の後に、**毎回実行する**ことが必要。（Linux ユーザは、自分の環境で使用可能なフォントを指定すること。）\n\nLinux ユーザ（[IPAexフォント](https://moji.or.jp/ipafont/) が利用可能である場合）は、\n\n```{r}\n#| message: false\nlibrary(fontregisterer)\ntheme_set(theme_gray(base_size = 9,\n                     base_family = \"IPAexGothic\"))\n```\n\nを実行する。\n\nmacOS ユーザは、\n\n```{r}\n#| eval: false\nlibrary(fontregisterer)\ntheme_set(theme_gray(base_size = 9,\n                     base_family = \"Hiragino Sans\"))\n```\n\nを実行する。\n\nWindows ユーザ（大学PCを含む）は、\n\n```{r}\n#| eval: false\nlibrary(fontregisterer)\ntheme_set(theme_gray(base_size = 9,\n                     base_family = \"Yu Gothic\"))\n```\n\nを実行する。\n\n\n:::callout-note\n利用可能なフォントは、`library(fontregisterer)` を実行した後に、自分のOSにあわせて以下のいずれかを実行することで確認できる。\n\n```{r}\n#| eval: false\n# Linux\nsystemfonts::system_fonts()$family\n```\n\n```{r}\n#| eval: false\n# macOS\nnames(quartzFonts())\n```\n\n```{r}\n#| eval: false\n# Windows\nnames(windowsFonts())\n```\n\n:::\n\n\n### データセットの読み込み {#sec-datasets}\n\nまず、今回の実習で利用するデータをダウンロードしよう。 準備として、現在利用しているプロジェクト（上で作ったフォルダ）の中に、**data** という名前のフォルダを作ろう。\n\n```{r}\n#| eval: false\ndir.create(\"data\")\n```\n\n次にデータセット [fake_data_01.csv](http://yukiyanai.github.io/jp/classes/stat2/contents/data/fake_data_01.csv) をダウンロードし、今作った data フォルダの中に保存する。\n\n```{r}\n#| eval: false\ndownload.file(\n  url = \"http://yukiyanai.github.io/jp/classes/stat2/contents/data/fake_data_01.csv\",\n  destfile = \"data/fake_data_01.csv\")\n```\n\nダウンロードがうまくいかない（あるいは、次の読み込み段階で失敗する）場合は、ファイル (`fake_data_01.csv`) を[ここ](http://yukiyanai.github.io/jp/classes/stat2/contents/data/fake_data_01.csv) から手動でダウンロードして、プロジェクト内の data ディレクトリに移動する。\n\n::: callout-warning\n毎年、Windows ユーザの中に `download.file()` がうまくいく者とそうでない者がいる。原因がよくわからない（担当者はWindows を使わない）ので、今回うまくいかない場合は、次回以降も毎回手動でデータをダウンロードしてほしい。\n:::\n\nこのデータは CSVと呼ばれる形式で保存されているので、`readr::read_csv()`という関数を使ってこのデータセットを読み込むことができる（他の形式で保存されたデータの使い方は必要に応じて後の授業で解説する）。\n\nこのデータセットを `myd` という名前で利用することにしよう（これはデータセットのファイル名を変えるのではなく、R上での呼び名を決めているだけである）。\n\n```{r read_csv}\n#| message: false\nmyd <- read_csv(\"data/fake_data_01.csv\")\n```\n\n読み込んだデータの中身を確認してみよう。 次のコマンドを打ち込むと、スプレッドシート（Excelの表のようなもの）上にデータが表示される。\n\n```{r}\n#| eval: false\nView(myd)\n```\n\n確認できたら、スプレッドシートのタブを閉じる。\n\n次に、コンソール上に、データセットの最上部または最下部にある数行分だけを表示してみよう。\n\n```{r}\nhead(myd)          # 行数を指定しないと6行分\ntail(myd, n = 8)   # 最後の8行分\n```\n\nデータセットに含まれる変数名を確認したいときは、\n\n```{r}\nnames(myd)\n```\n\nとする。\n\nデータセットに含まれる観測数 ($n$) と変数の数を知りたいときは、\n\n```{r}\ndim(myd)\n```\n\nとする。最初の数字が$n$の数（データセットの行数）、2番目の数字が変数の数（列数）である（RStudio を使うと、右上のウィンドウの\"Environment\" というタブにこの情報が既に表示されているので、そこで確認してもよい）。\n\nまた、データセットの確認には、`glimpse()` も便利である。\n\n```{r}\nglimpse(myd)\n```\n\nデータセットに含まれるすべての変数の基本的な統計量を確認したいときは、\n\n```{r}\nsummary(myd)\n```\n\nとする。\n\n### 基本的な統計量の計算 {#sec-stats}\n\n基本的な統計量の計算方法を学習しよう。Rにはよく使われる統計量を計算するための関数があらかじめ用意されているので、関数を利用する。Rの関数の基本的な形は、`関数名()` である。この `()` の中に何を書くべきかは、関数によって異なる。Rの関数の使い方を身につけるためには、`()` の中身を適切に指定できるようになることが必要である。`()` の中身は関数の**引数（ひきすう; arguments）**と呼ばれる。\n\n::: callout-note\n引数には仮引数 (paramter) と実引数 (argument) という区別があるが、現時点では深入りしないことにする。気になる場合は、[この説明](http://www.cc.kyoto-su.ac.jp/~yamada/ap/parameter_argument.html) を参照されたい。\n:::\n\n私たちが利用しているデータセット `myd` に含まれる `height`（身長）という変数 (variable) の平均値（算術平均; mean）を求めよう。Rでは、`mean(変数名)`とすると、平均値が求められる。\n\nただし、`height` という変数は `myd` というデータの の一部（1つの変数, 1つの列）なので、それをRに伝える必要がある。データセットの中身の変数を使うときは、\\$ マークを使って、`データセット名$変数名`とすればよい。よって、height の平均値は\n\n```{r}\nmean(myd$height)\n```\n\nである。\n\n次に、身長の中央値 (median) を求めよう。中央値は `median()` で求められるので、\n\n```{r}\nmedian(myd$height)\n```\n\nである。\n\n続いて、身長の分散 (variance) を求めよう。分散（より正確には、不偏分散）は、`var()`で求める。したがって、\n\n```{r}\nvar(myd$height)\n```\n\nである。\n\n今度は、標準偏差 (standard deviation) を求めよう。標準偏差は、`sd()` で計算できるので、\n\n```{r}\nsd(myd$height)\n```\n\nである。また、標準偏差は分散の平方根 (square root) なので、`sqrt()` を使って、\n\n```{r}\nsqrt(var(myd$height))\n```\n\nとしても、`sd()` を使った場合と同じ結果が得られる。\n\n次に、範囲 (range)を求めよう。最大値は `max()`、最小値は `min()` で求められるので、範囲は\n\n```{r}\nmax(myd$height) - min(myd$height)\n```\n\nである。`range()` という関数もあるが、この関数の結果は\n\n```{r}\nrange(myd$height)\n```\n\nとなり、区間が表示されるので注意が必要である。\n\n続いて、四分位範囲 (interquartile range; IQR) を求めよう。`IQR()` を使う。\n\n```{r}\nIQR(myd$height)\n```\n\nちなみに、第1四分位数すなわち25パーセンタイルは `quantile()` 関数を使って求めることができる。\n\n```{r}\n(q1 <- quantile(myd$height, prob = 0.25))\n```\n\n同様に第3四分位数すなわち75パーセンタイルは、\n\n```{r}\n(q3 <- quantile(myd$height, prob = 0.75))\n```\n\nである。第3四分位数から第1四分位数を引くと、\n\n```{r}\nq3 - q1\n```\n\nとなり、先ほど`IQR()`求めた四分位範囲と一致することが確認できる。\n\n`quantile()` を使うと、自分の好きなパーセンタイルを求めることができる。 例として、22パーセンタイルと77パーセンタイル、87パーセンタイルを同時に求めてみよう。\n\n```{r}\nquantile(myd$height, prob = c(0.22, 0.77, 0.87))\n```\n\nこれを使えば、身長 `height` の五数要約 (five-number summary) を表示することができる。次のようにすればよい。\n\n```{r}\nquantile(myd$height, prob = c(0, 0.25, 0.5, 0.75, 1))\n```\n\n五数要約のための関数 `fivenum()` を使うこともできる。\n\n```{r}\nfivenum(myd$height)\n```\n\n（一部の結果が四捨五入されていることを除けば）同じ結果が得られた。\n\n**課題**\n\n-   体重 (weight) について、平均値、中央値、分散、標準偏差、四分位範囲を求めよう。\n-   所得 (income) について、平均値、中央値、分散、標準偏差、四分位範囲を求めよう。\n\n### 変数の可視化 {#sec-viz1}\n\n変数の特徴は統計量によってある程度把握することができるが、統計量だけではわかりにくい特徴もある。そこで、データ分析を行う際には、図を作って自分が持っているデータを可視化するという作業が必要かつ重要である。\n\n今日は、**ggplot2**パッケージを使って、簡単な図をいくつか作ってみよう。**ggplot2**は先ほど読み込んだ **tidyverse** の一部なので、新たに読み込む必要はない。また、**ggplot2**の詳しい使い方は Topic 5 で解説するので、今日はコードの中身まで理解しなくてもよい。\n\nまず、最も基本的かつよく使う図であるヒストグラム　(histogram) を作ってみよう。 ggplot2では `geom_histogram()` でヒストグラムを作ることができる。\n\n例として、身長のヒストグラムを描いてみよう。\n\n```{r}\n#| message: false\nhist_h <- ggplot(myd, aes(x = height)) +\n  geom_histogram(color = \"black\")\nplot(hist_h)\n```\n\nこれでとりあえずヒストグラムが描ける。\n\nこのヒストグラムを元にして、様々なカスタマイズが可能である。例えば、横軸と縦軸のラベル (label) を変えたいときは、次のように `labs()`を加える。\n\n```{r}\n#| message: false\nhist_h2 <- hist_h + \n    labs(x = \"身長 (cm)\", y = \"度数\")\nplot(hist_h2)\n```\n\nバーの色を変えたいときは、`geom_histogram()` で `fill` を指定する。 指定可能な色については [このページ](http://www.okadajp.org/RWiki/?%E8%89%B2%E8%A6%8B%E6%9C%AC) を参照。\n\n```{r}\n#| message: false\nhist_h3 <- ggplot(myd, aes(x = height)) +\n  geom_histogram(color = \"black\", fill = \"dodgerblue\") +\n  labs(x = \"身長 (cm)\", y = \"度数\")\nplot(hist_h3)\n```\n\nヒストグラムのビン（棒）の幅は、`binwidth` で指定できる。\n\n```{r}\nhist_h4 <- ggplot(myd, aes(x = height)) +\n  geom_histogram(color = \"black\", \n                 fill = \"royalblue\", \n                 binwidth = 5) +\n  labs(x = \"身長 (cm)\", y = \"度数\")\nplot(hist_h4)\n```\n\nヒストグラムの縦軸を度数 (frequency, count) ではなく確率密度 (probability density) に変えたいときは、y軸に `after_stat(density)` を指定する。\n\n```{r}\nhist_h5 <- ggplot(myd, aes(x = height, y = after_stat(density))) +\n  geom_histogram(color = \"black\", \n                 fill = \"dodgerblue\", \n                 binwidth = 5) +\n  labs(x = \"身長 (cm)\", y = \"確率密度\")\nprint(hist_h5)\n```\n\n**課題**\n\n-   体重 (weight) のヒストグラム（色付き）を作り、日本語でラベルを付けよう。\n-   所得 (income) のヒストグラム（色付き）を作り、日本語でラベルを付けよう。\n\n## 2変数の記述統計とデータの可視化 {#sec-2var}\n\n### 2つの量的変数の関係を図示する {#sec-bivarviz}\n\n2つの量的変数の関係は、散布図 (scatter plot) で確認する。ここでは、身長 (height) と体重 (weight) の関係を図示してみよう。ggplot2では、`geom_point()` で散布図ができる。\n\n```{r scatter1}\nscat <- ggplot(myd, aes(x = height, y = weight)) +\n  geom_point() +\n  labs(x = \"身長 (cm)\", y = \"体重 (kg)\")\nplot(scat)\n```\n\nこのデータセットに含まれる身長と体重の間には、どのような関係があるだろうか？\n\n### 2つの量的変数の関係を統計量で示す {#sec-bivarstat}\n\n2つの量的変数の関係を表すのにもっともよく使われるのは、相関係数 (correlation coefficient) である。この統計量は、$r$ で表されることが多い。$-1 \\leq r \\leq 1$となる。$a$と$b$ という2つの変数があったとき、$a$が大きくなるほど$b$ も大きくなるという関係があるとき、「$a$と$b$には正の相関 (positive correlation) がある」と言い、このとき $r > 0$ である。また、$a$が大きくなるほど$b$ が小さくなるという関係があるとき、「$a$と$b$には負の相関 (negative correlation) がある」と言い、このとき $r < 0$ である。$r = 0$ のとき、「$a$と$b$は相関関係がない」と言う。\n\n正の相関があるとき、$r$が$1$に近いほど、その関係は強い。また、負の相関があるとき、$r$が$-1$に近いほど、その関係は強い。つまり、相関関係は、相関係数の絶対値が1に近いほど強い。\n\nRで相関係数を求めるときは、`cor()`を使う。身長と体重の相関係数は、\n\n```{r}\ncor(myd$height, myd$weight)\n```\n\nである。この2変数にはどんな関係があるだろうか？\n\n### 散布図と相関係数 {#sec-scatcor}\n\n2つの量的な変数の関係を調べるときは、散布図と相関係数の**両者**を使ったほうがよい。\n\n散布図だけを使うと、本当は存在しない関係を、誤って見つけてしまうことがある。例えば、本当は相関がない2つの変数の散布図を描いたとき、描かれた点がなんとなく右肩上がりの直線の周りに集まっているように見えてしまうことがある。これは、人間がパタンを見つける能力に優れている（優れ過ぎている？）からだと考えられる。偶然できた壁のシミが人間の顔に見えてしまうことがあるというのも似たような現象である。\n\n散布図だけに頼ると、存在しないパタンが見えてしまうことがあるので、散布図で発見したパタンが本当にあるかどうか、相関係数を求めて確かめるべきである。\n\n反対に、相関係数だけに頼るのも危険である。相関係数は、2変数のあらゆる関係を捉えられるわけではない。相関係数が示すのは、2つの変数の**直線的な関係だけ**である。\n\n例として、$x$ と$y$ という2つの変数を以下のとおり作り、相関係数を計算してみよう。\n\n```{r}\nx <- -10:10\ny <- x ^ 2\ncor(x, y)\n```\n\n2変数と$x$と$y$の相関係数は（ほぼ）0である。相関係数だけに頼ると、2つの変数の間には関係がないと言う結論が出せそうである。しかし、相関係数が低くても、必ず散布図を描いたほうがよい。散布図を作ってみよう。\n\n```{r plot-x-y}\nnewd <- tibble(x = x, y = y)\nscat2 <- ggplot(newd, aes(x = x, y = y)) +\n  geom_point()\nplot(scat2)\n```\n\nこの図を見て、$x$と$y$は無関係と言えるだろうか？\n\n散布図から明らか（$y$をどのように作ったかを見ればもっと明らかだが）なように、$x$と$y$には強い関係がある（$y$は$x$の関数である）。しかし、その関係は**曲線的** なので、**直線的な関係しか捉えられない相関係数**は、強い関係を見落としてしまうのである。\n\n::: callout-important\n2つの量的変数の関係を調べるときは、**散布図と相関係数の両方を確認する**習慣を身につけよう。\n:::\n"},"formats":{"html":{"execute":{"fig-width":5,"fig-height":4,"fig-format":"retina","fig-dpi":96,"error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":true,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"self-contained-math":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"number-sections":true,"highlight-style":"arrow","html-math-method":"mathjax","output-file":"descriptive-stat.html"},"language":{"toc-title-document":"このページの内容","toc-title-website":"On this page","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"注","callout-tip-caption":"ヒント","callout-note-caption":"備考","callout-warning-caption":"注意","callout-important-caption":"重要","callout-danger-caption":"危険！","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"コードを表示","code-tools-hide-all-code":"コードを隠す","code-tools-view-source":"Source を見る","code-tools-source-code":"Source Code","copy-button-tooltip":"コピーする","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","crossref-fig-title":"図","crossref-tbl-title":"表","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Newest","listing-page-order-by-date-desc":"Oldest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"crossref":{"ref-hyperlink":true},"theme":"yeti"},"extensions":{"book":{"multiFile":true}}}}}